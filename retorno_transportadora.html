<!DOCTYPE html>
<html lang="pt-br">
<head>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Retorno Transportadora</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="css/styles.css" rel="stylesheet"/>
</head>
<body>
<!--
    A navbar permanece sempre colapsada para reduzir a poluição visual.
    A classe `navbar-expand-lg` foi removida para que o menu só apareça
    quando o usuário clicar no ícone de três barras.
  -->
  <nav class="navbar navbar-dark bg-dark mb-4">
  <div class="container-fluid">
    <span class="navbar-brand d-flex align-items-center fw-bold">
      <img src="logo.png" alt="Logo" height="40" class="me-2" />
      Coletas KOERICH
    </span>

    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarLinks" aria-controls="navbarLinks" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarLinks">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0" id="menu-links"></ul>
      <span class="navbar-text text-white me-3" id="user-info"></span>
    </div>
  </div>
</nav>

<div class="container">
  <h3 class="mb-4">Retornos da Transportadora</h3>
  <!-- Campo de busca para filtrar retornos -->
  <div class="mb-3">
    <input id="searchInput" type="text" class="form-control" placeholder="Buscar por NF ou transportadora" />
  </div>
  <table class="table table-bordered">
    <thead class="table-light">
      <tr>
        <!-- Cabeçalhos clicáveis para ordenação -->
        <th role="button" style="cursor:pointer;" onclick="ordenarRetTrans('nf_origem')">NF Origem</th>
        <th role="button" style="cursor:pointer;" onclick="ordenarRetTrans('nf_devolucao')">NF Devolução</th>
        <th role="button" style="cursor:pointer;" onclick="ordenarRetTrans('data_prevista')">Data Prevista</th>
        <th role="button" style="cursor:pointer;" onclick="ordenarRetTrans('status')">Status</th>
        <th role="button" style="cursor:pointer;" onclick="ordenarRetTrans('transportadora')">Transportadora</th>
        <th role="button" style="cursor:pointer;" onclick="ordenarRetTrans('observacao')">Observação</th>
        <th>Ação</th>
      </tr>
    </thead>
    <tbody id="tabelaRetornos"></tbody>
  </table>

  <!-- Paginação de retornos da transportadora -->
  <nav aria-label="Paginação de retornos da transportadora" class="mt-3">
    <ul class="pagination justify-content-center" id="paginationRetTrans"></ul>
  </nav>
</div>

<!-- Modal para reencaminhar (admin) -->
<div class="modal fade" id="modalReencaminhar" tabindex="-1">
  <div class="modal-dialog">
    <form class="modal-content" id="formReencaminhar">
      <div class="modal-header">
        <h5 class="modal-title">Reencaminhar Coleta</h5>
        <button class="btn-close" data-bs-dismiss="modal" type="button"></button>
      </div>
      <div class="modal-body">
        <label class="form-label">Nova Transportadora</label>
        <select class="form-select" name="nova_transportadora" id="selectNovaTransportadora" required>
          <option value="">Selecione</option>
        </select>
        <input name="index" type="hidden"/>
      </div>
      <div class="modal-footer">
        <button class="btn btn-success" type="submit">Confirmar</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal para devolução (transportadora comum) -->
<div class="modal fade" id="modalDevolucao" tabindex="-1">
  <div class="modal-dialog">
    <form class="modal-content" id="formDevolucao">
      <div class="modal-header">
        <h5 class="modal-title">Motivo da Devolução</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <textarea class="form-control" name="observacao" placeholder="Informe o motivo..." required></textarea>
        <input type="hidden" name="index" />
      </div>
      <div class="modal-footer">
        <button type="submit" class="btn btn-danger">Confirmar Devolução</button>
      </div>
    </form>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="js/menu.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const select = document.getElementById("selectNovaTransportadora");
    if (select) {
      const lista = JSON.parse(localStorage.getItem("listaTransportadoras") || "[]");
      select.innerHTML = '<option value="">Selecione</option>';
      lista.forEach(nome => {
        const opt = document.createElement("option");
        opt.value = nome;
        opt.textContent = nome;
        select.appendChild(opt);
      });
    }
  });
</script>
<script src="js/retorno_transportadora.js"></script>
<!-- A verificação de acesso do administrador é realizada no arquivo
     retorno_transportadora.js. Este bloco foi removido para evitar
     redeclaração da constante currentUser. -->
</body>
</html>
